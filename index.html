<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Tree with Different Shaped Apples</title>
    <style>
      html, body {
        height: 100%;
        margin: 0;
      }
      #c {
        width: 100%;
        height: 100%;
        display: block;
      }

    </style>
  </head>
  <body>
    <canvas id="c"></canvas>
    <script type="importmap">
      {
        "imports": {
          "three": "https://threejs.org/build/three.module.js",
          "three/addons/": "https://threejs.org/examples/jsm/"
        }
      }
    </script>
  </body>
  <script type="module">

    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
    import { MTLLoader } from 'three/addons/loaders/MTLLoader.js';

    const grass_image_url ="grass_seamless.png";
    const sky_image_url = "sky_seamless.png";


    function main() {
        
        const canvas = document.querySelector( '#c' );
        const renderer = new THREE.WebGLRenderer({
          antialias: true,
          canvas,
          alpha: true,
        });

        // Scene
        const scene = new THREE.Scene();

        // Camera
        const fov = 45;
        const aspect = 2; // the canvas default
        const near = 0.1;
        const far = 100;
        const camera = new THREE.PerspectiveCamera( fov, aspect, near, far );
        camera.position.set( 0, 4, 4 );

        const controls = new OrbitControls( camera, canvas );
        controls.target.set( 0, .5, 0 );
        controls.update();
        

        // Added glass plane
        {
          const planeSize = 7;

          const grass_loader = new THREE.TextureLoader();
          const texture = grass_loader.load(grass_image_url);
          texture.colorSpace = THREE.SRGBColorSpace;
          texture.wrapS = THREE.RepeatWrapping;
          texture.wrapT = THREE.RepeatWrapping;
          texture.magFilter = THREE.NearestFilter;
          const repeats = planeSize / 2;
          texture.repeat.set(repeats, repeats);

          const planeGeo = new THREE.PlaneGeometry(planeSize, planeSize);
          const planeMat = new THREE.MeshPhongMaterial({
              map: texture,
              side: THREE.DoubleSide
          });

          const mesh = new THREE.Mesh(planeGeo, planeMat);
          mesh.rotation.x = Math.PI * -.5;
          scene.add(mesh);
        }

        // Added skybox
        {
          const sky_loader = new THREE.TextureLoader();
          const bgTexture = sky_loader.load(sky_image_url);
          bgTexture.colorSpace = THREE.SRGBColorSpace;
          scene.background = bgTexture;
        }

        // Add a light
        {
          const skyColor = 0xb1e1ff; // light blue
          const groundColor = 0xb97a20; // brownish orange
          const intensity = 3;
          const light = new THREE.HemisphereLight(skyColor,groundColor,intensity);
          scene.add(light);
        }

        function makeInstance( geometry, material, x, y, z, rx, ry, rz) {
          const cube = new THREE.Mesh(geometry, material);
          scene.add(cube);

          cube.position.x = x;
          cube.position.y = y;
          cube.position.z = z;
          cube.rotation.x = rx;
          cube.rotation.y = ry;
          cube.rotation.z = rz;

          return cube;
        }

        // Add boxes
        {
          const box_loader = new THREE.TextureLoader();
          const box_texture = box_loader.load("wooden_crate.png");
          box_texture.colorSpace = THREE.SRGBColorSpace;
          const box_material = new THREE.MeshBasicMaterial({map: box_texture});
          const box_geometry = new THREE.BoxGeometry(.4, .4, .4);
          
          const shapes = [
            makeInstance(box_geometry, box_material, 2.4, .15, 0, 0, 20, 0),
            makeInstance(box_geometry, box_material, 2.4, .15, 0.4, 0, 22, 0),
            makeInstance(box_geometry, box_material, 2.4, .55, 0.2, 0, -45, 0)
          ];
        }
        
        // Add Tree
        {
          const mtlLoader = new MTLLoader();
          mtlLoader.load( 'materials.mtl', ( mtl ) => {
              mtl.preload();
              const objLoader = new OBJLoader();
              objLoader.setMaterials( mtl );
              objLoader.load( 'tree.obj', ( root ) => {
                  root.position.y = 1.2
                  scene.add( root );

              } );
          } );
        }

        // Rendering
        function resizeRendererToDisplaySize(renderer) {
            const canvas = renderer.domElement;
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            const needResize = canvas.width !== width || canvas.height !== height;
            if (needResize) {
            renderer.setSize(width, height, false);
            }

            return needResize;
        }

        function render() {
            if (resizeRendererToDisplaySize(renderer)) {
            const canvas = renderer.domElement;
            camera.aspect = canvas.clientWidth / canvas.clientHeight;
            camera.updateProjectionMatrix();
            }

            renderer.render(scene, camera);

            requestAnimationFrame(render);
        }
        requestAnimationFrame(render);
    }
    
    main();

  </script>
<!-- 
    Credits:
    Tree by Marc SolÃ  [CC-BY] (https://creativecommons.org/licenses/by/3.0/) via Poly Pizza (https://poly.pizza/m/6Yjt8nIwLsD)
    grass_seammless.png from 123rf.com
    sky_seamless.png from https://opengameart.org/content/seamless-sky-backgrounds
    wooden_crate.png from https://opengameart.org/content/pixel-wooden-crate
    
-->
</html>
